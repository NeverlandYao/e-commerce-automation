# Crawler Sidecar Process

è¿™æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„ä¾§è½¦è¿›ç¨‹ï¼Œç”¨äºä¸º Tauri åº”ç”¨æä¾›ç”µå•†ç½‘ç«™çˆ¬è™«åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å¤šå¹³å°æ”¯æŒ**: æ”¯æŒæ·˜å®ã€äº¬ä¸œã€äºšé©¬é€Šç­‰ä¸»æµç”µå•†å¹³å°
- ğŸ­ **åæ£€æµ‹æœºåˆ¶**: ä½¿ç”¨ Playwright å’Œå¤šç§åæ£€æµ‹ç­–ç•¥
- ğŸ”„ **å¹¶å‘æ§åˆ¶**: æ”¯æŒæ‰¹é‡çˆ¬å–å’Œå¹¶å‘é™åˆ¶
- ğŸ“Š **æ•°æ®æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„æ•°æ®æ ¼å¼è¾“å‡º
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- ğŸ“ **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œè°ƒè¯•ä¿¡æ¯

## é¡¹ç›®ç»“æ„

```
sidecar-crawler/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.js              # ä¸»å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ crawler/
â”‚   â”‚   â””â”€â”€ CrawlerEngine.js # çˆ¬è™«å¼•æ“
â”‚   â”œâ”€â”€ platforms/
â”‚   â”‚   â”œâ”€â”€ PlatformManager.js # å¹³å°ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ taobao.js        # æ·˜å®é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ jd.js            # äº¬ä¸œé€‚é…å™¨
â”‚   â”‚   â””â”€â”€ amazon.js        # äºšé©¬é€Šé€‚é…å™¨
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ Logger.js        # æ—¥å¿—å·¥å…·
â”œâ”€â”€ bin/                     # ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶
â”œâ”€â”€ package.json
â”œâ”€â”€ build.js                 # æ„å»ºè„šæœ¬
â””â”€â”€ README.md
```

## å®‰è£…ä¾èµ–

```bash
npm install
```

## å¼€å‘æ¨¡å¼è¿è¡Œ

```bash
npm run dev
```

## æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶

### æ„å»ºæ‰€æœ‰å¹³å°

```bash
npm run build
```

### æ„å»ºç‰¹å®šå¹³å°

```bash
# macOS (x64)
npm run build:macos

# Windows (x64)
npm run build:windows

# Linux (x64)
npm run build:linux
```

### ä½¿ç”¨æ„å»ºè„šæœ¬

```bash
# æ„å»ºæ‰€æœ‰å¹³å°
node build.js

# æ„å»ºç‰¹å®šå¹³å°
node build.js macos-x64
node build.js macos-x64 linux-x64

# æ¸…ç†æ„å»ºæ–‡ä»¶
node build.js clean

# åˆ—å‡ºå·²æ„å»ºçš„æ–‡ä»¶
node build.js list

# æ˜¾ç¤ºå¸®åŠ©
node build.js help
```

## API æ¥å£

ä¾§è½¦è¿›ç¨‹å¯åŠ¨åä¼šåœ¨éšæœºç«¯å£ä¸Šè¿è¡Œ HTTP æœåŠ¡å™¨ï¼Œå¹¶å°†ç«¯å£å·è¾“å‡ºåˆ° stdoutã€‚

### å¥åº·æ£€æŸ¥

```http
GET /health
```

å“åº”:
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "uptime": 12345
}
```

### çˆ¬å–å•†å“

```http
POST /crawl
Content-Type: application/json

{
  "type": "product",
  "url": "https://item.taobao.com/item.htm?id=123456789",
  "platform": "taobao",
  "options": {
    "timeout": 30000,
    "retries": 3
  }
}
```

### æœç´¢å•†å“

```http
POST /crawl
Content-Type: application/json

{
  "type": "search",
  "keyword": "iPhone 15",
  "platform": "taobao",
  "options": {
    "maxPages": 3,
    "maxResults": 50
  }
}
```

### æ‰¹é‡çˆ¬å–

```http
POST /crawl
Content-Type: application/json

{
  "type": "batch",
  "urls": [
    "https://item.taobao.com/item.htm?id=123456789",
    "https://item.jd.com/123456789.html"
  ],
  "options": {
    "concurrency": 3,
    "delay": 1000
  }
}
```

### è·å–çŠ¶æ€

```http
GET /status
```

å“åº”:
```json
{
  "status": "running",
  "activeTasks": 2,
  "completedTasks": 15,
  "failedTasks": 1,
  "supportedPlatforms": ["taobao", "jd", "amazon"]
}
```

## æ”¯æŒçš„å¹³å°

### æ·˜å® (taobao)
- å•†å“è¯¦æƒ…é¡µ
- æœç´¢ç»“æœé¡µ
- å•†å“åˆ—è¡¨é¡µ

### äº¬ä¸œ (jd)
- å•†å“è¯¦æƒ…é¡µ
- æœç´¢ç»“æœé¡µ
- å•†å“åˆ—è¡¨é¡µ

### äºšé©¬é€Š (amazon)
- å•†å“è¯¦æƒ…é¡µ
- æœç´¢ç»“æœé¡µ
- å•†å“åˆ—è¡¨é¡µ

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

- `NODE_ENV`: è¿è¡Œç¯å¢ƒ (development/production)
- `DEBUG`: å¯ç”¨è°ƒè¯•æ—¥å¿—
- `TRACE`: å¯ç”¨è·Ÿè¸ªæ—¥å¿—
- `NO_COLOR`: ç¦ç”¨å½©è‰²è¾“å‡º
- `PORT`: æŒ‡å®šæœåŠ¡å™¨ç«¯å£ (é»˜è®¤éšæœº)

### çˆ¬è™«é€‰é¡¹

- `timeout`: è¯·æ±‚è¶…æ—¶æ—¶é—´ (æ¯«ç§’)
- `retries`: é‡è¯•æ¬¡æ•°
- `delay`: è¯·æ±‚é—´éš” (æ¯«ç§’)
- `concurrency`: å¹¶å‘æ•°
- `maxPages`: æœ€å¤§é¡µæ•°
- `maxResults`: æœ€å¤§ç»“æœæ•°
- `userAgent`: è‡ªå®šä¹‰ User-Agent
- `proxy`: ä»£ç†è®¾ç½®

## é”™è¯¯å¤„ç†

ä¾§è½¦è¿›ç¨‹åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶:

- ç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•
- é¡µé¢åŠ è½½è¶…æ—¶å¤„ç†
- åçˆ¬è™«æ£€æµ‹åº”å¯¹
- æ•°æ®è§£æé”™è¯¯å¤„ç†
- èµ„æºæ¸…ç†å’Œå†…å­˜ç®¡ç†

## æ—¥å¿—è®°å½•

æ”¯æŒå¤šçº§åˆ«æ—¥å¿—è®°å½•:

- `INFO`: ä¸€èˆ¬ä¿¡æ¯
- `WARN`: è­¦å‘Šä¿¡æ¯
- `ERROR`: é”™è¯¯ä¿¡æ¯
- `DEBUG`: è°ƒè¯•ä¿¡æ¯ (å¼€å‘æ¨¡å¼)
- `TRACE`: è·Ÿè¸ªä¿¡æ¯ (å¼€å‘æ¨¡å¼)

## æ€§èƒ½ä¼˜åŒ–

- æµè§ˆå™¨å®ä¾‹å¤ç”¨
- é¡µé¢èµ„æºè¿‡æ»¤
- å†…å­˜ä½¿ç”¨ç›‘æ§
- å¹¶å‘æ§åˆ¶
- ç¼“å­˜æœºåˆ¶

## å®‰å…¨è€ƒè™‘

- CORS é…ç½®
- è¯·æ±‚å¤´å®‰å…¨
- è¾“å…¥éªŒè¯
- é”™è¯¯ä¿¡æ¯è¿‡æ»¤
- èµ„æºé™åˆ¶

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**: ä¾§è½¦è¿›ç¨‹ä¼šè‡ªåŠ¨é€‰æ‹©å¯ç”¨ç«¯å£
2. **æµè§ˆå™¨å¯åŠ¨å¤±è´¥**: æ£€æŸ¥ Playwright å®‰è£…
3. **ç½‘ç»œè¿æ¥é—®é¢˜**: æ£€æŸ¥ç½‘ç»œå’Œä»£ç†è®¾ç½®
4. **å†…å­˜ä¸è¶³**: è°ƒæ•´å¹¶å‘æ•°å’Œè¶…æ—¶è®¾ç½®

### è°ƒè¯•æ¨¡å¼

```bash
DEBUG=1 npm run dev
```

### æŸ¥çœ‹æ—¥å¿—

ä¾§è½¦è¿›ç¨‹çš„æ‰€æœ‰æ—¥å¿—éƒ½ä¼šè¾“å‡ºåˆ° stdout/stderrï¼Œå¯ä»¥é€šè¿‡ Tauri åº”ç”¨æ•è·å’ŒæŸ¥çœ‹ã€‚

## è®¸å¯è¯

MIT License